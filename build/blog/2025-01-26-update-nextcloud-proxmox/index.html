<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Updating Nextcloud on Proxmox LXC with Alpine Linux - maocypher.dev </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Updating Nextcloud installed on Proxmox as LXC with Alpine Linux as OS. Installed via community-scripts- Updating Nextcloud on Proxmox LXC with Alpine Linux"> <meta name="keywords" content="Updating Nextcloud on Proxmox LXC with Alpine Linux, maocypher.dev, homelab,homelab, nextcloud, proxmox, lxc, alpine"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="maocypher.dev" property="og:site_name" /> <meta content="Updating Nextcloud on Proxmox LXC with Alpine Linux" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Updating Nextcloud installed on Proxmox as LXC with Alpine Linux as OS. Installed via community-scripts" property="og:description" /> <meta content="http://localhost:4000/blog/2025-01-26-update-nextcloud-proxmox/" property="og:url" /> <meta content="2025-01-26T00:00:00+01:00" property="article:published_time" /> <meta content="http://localhost:4000/about/" property="article:author" /> <meta content="http://localhost:4000/assets/img/posts/nextcloud.jpg" property="og:image" /> <meta content="homelab" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Updating Nextcloud on Proxmox LXC with Alpine Linux" /> <meta name="twitter:url" content="http://localhost:4000/blog/2025-01-26-update-nextcloud-proxmox/" /> <meta name="twitter:description" content="Updating Nextcloud installed on Proxmox as LXC with Alpine Linux as OS. Installed via community-scripts" /> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://localhost:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://localhost:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://localhost:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://localhost:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://localhost:4000/assets/js/mode-switcher.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://localhost:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://localhost:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://localhost:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://localhost:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://localhost:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://localhost:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://localhost:4000/assets/js/search.js"></script> <script src="http://localhost:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!-- buy me a coffeee --> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="maocypher" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">maocypher.dev</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/blog" >Blog</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Updating Nextcloud on Proxmox LXC with Alpine Linux</h1> <h4 class="post-meta">Updating Nextcloud installed on Proxmox as LXC with Alpine Linux as OS. Installed via community-scripts</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://localhost:4000/blog/authors/maocypher">maocypher</a></span> </span > on <time datetime="2025-01-26 00:00:00 +0100" itemprop="datePublished" >Jan 26, 2025</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/2025-01-26-update-nextcloud-proxmox/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/homelab" >homelab</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="http://localhost:4000/assets/img/posts/nextcloud.jpg" alt="" /> <br /> <br /> <h2 id="installing-nextcloud-on-proxmox">Installing Nextcloud on Proxmox</h2> <p>For installing Nextcloud on my Proxmox VE as LXC with Alpine Linux I used the <a href="https://github.com/tteck/Proxmox">Proxmox helper scripts from tteck</a> (now continued in the <a href="https://community-scripts.github.io/ProxmoxVE/">community scripts</a>)</p> <p>I followed <code class="language-plaintext highlighter-rouge">How-to-install</code> for Alpine-Linux with the <a href="https://community-scripts.github.io/ProxmoxVE/scripts?id=nextcloudpi">community script</a> and was happy until I did my first try updating Nextcloud to the next major version.</p> <h2 id="upgrading-nextcloud">Upgrading Nextcloud</h2> <p>First I tried to follow the manual from <a href="https://docs.nextcloud.com/server/latest/admin_manual/maintenance/upgrade.html">Nextcloud</a> to upgrade to the next major version, but it failed completely and I wasnâ€™t able to get it running again. So I reverted my changes and installed my backup.</p> <blockquote> <p><strong>CAUTION</strong> Make sure you have a valid backup before starting with the upgrade</p> </blockquote> <ul> <li>Identify the version of your nextcloud hub. You can find this on the Admin UI <code class="language-plaintext highlighter-rouge">Administrator Settings -&gt; Overview -&gt; Version</code></li> <li>Set nextcloud into <code class="language-plaintext highlighter-rouge">Maintenance mode</code> by calling <code class="language-plaintext highlighter-rouge">occ maintenance:mode --on</code>. Unlike on other installation of nextcloud on alpine it wasnâ€™t necessary for me to call it like this <code class="language-plaintext highlighter-rouge">sudo -u www-data php occ maintenance:mode --on</code>. On the one hand <code class="language-plaintext highlighter-rouge">sudo</code> isnâ€™t installed and on the other hand the users are either <code class="language-plaintext highlighter-rouge">nextcloud</code> or <code class="language-plaintext highlighter-rouge">nginx</code> depending on the installed nextcloud version.</li> <li>With <code class="language-plaintext highlighter-rouge">apk list | grep nextcloud | grep installed</code> you can list all nextcloud packages that are installed</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># enable maintenance mode</span>
occ maintenance:mode <span class="nt">--on</span>

<span class="c"># list current installed packages (here you can already see possible dependency packages that must also be updated)</span>
apk list | <span class="nb">grep </span>nextcloud | <span class="nb">grep </span>installed
</code></pre></div></div> <blockquote> <p><strong>Hint</strong> In my case I only had nextcloud packages (without the version in the package name) which was nextcloud hub 27</p> </blockquote> <blockquote> <p><strong>Tip</strong> On <a href="https://pkgs.alpinelinux.org/packages?name=nextcloud*&amp;branch=edge&amp;repo=&amp;arch=x86_64&amp;origin=&amp;flagged=&amp;maintainer=">alpine packages</a> you can find current available nextcloud packages</p> </blockquote> <ul> <li>Install the next major version of nextcloud hub e.g. <code class="language-plaintext highlighter-rouge">apk add nextcloud28</code> if this runs into issues because <code class="language-plaintext highlighter-rouge">nextcloud</code> is blocking files you can try running <code class="language-plaintext highlighter-rouge">apk add nextcloud28 --force-overwrite</code></li> <li>Run <code class="language-plaintext highlighter-rouge">occ upgrade</code> to start the upgrade process. During this step it might happen that occ cannot finish the update, because apps are not compatible the new version. In that case I disabled all apps by using this command e.g. <code class="language-plaintext highlighter-rouge">occ app:disable files_sharing</code></li> <li>All the packages you disabled are probably available as alpine package and should be installed manually e.g. <code class="language-plaintext highlighter-rouge">apk add nextcloud29-files_sharing</code>. Also here when nextcloud was blocking I installed it with <code class="language-plaintext highlighter-rouge">apk add nextcloud29-files_sharing --force-overwrite</code></li> <li>When you updated all dependencies try running <code class="language-plaintext highlighter-rouge">occ upgrade</code> it should be successful now.</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install nextcloud hub; optional use --force-overwrite</span>
apk add nextcloud28

<span class="c"># the first run of this will fail very likely due to dependencies</span>
occ upgrade

<span class="c"># disable dependency packages and upgrade them manually; optional use --force-overwrite if necessary</span>
<span class="c"># repeat this for all of your dependencies</span>
occ app:disable &lt;your dependency package&gt;
apk add nextcloud28-&lt;your dependency package&gt;

<span class="c"># should be successful now</span>
occ upgrade
</code></pre></div></div> <ul> <li>Finalize the upgrade scripts from nextcloud</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>occ db:add-missing-columns
occ db:add-missing-indices
occ db:add-missing-primary-keys
</code></pre></div></div> <ul> <li>Remove old nextcloud packages e.g.</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First steps depends on your nextcloud version and installed dependencies</span>
apk del nextcloud-federation nextcloud-notifications nextcloud-files_trashbin nextcloud-dashboard nextcloud-mysql nextcloud-comments nextcloud-admin_audit nextcloud-files_external nextcloud-support nextcloud-weather_status nextcloud-systemtags nextcloud-default-apps nextcloud-files_sharing nextcloud-sharebymail nextcloud-user_status nextcloud-files_versions nextcloud-encryption nextcloud-initscript nextcloud-suspicious_login
apk del nextcloud
</code></pre></div></div> <ul> <li>Disable the maintenance mode again and try access nextcloud. Depending on the changes that were made by nextcloud you are not done with the upgrade yet and you will fail seeing the login page.</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>occ maintenance:mode <span class="nt">--off</span>
</code></pre></div></div> <ul> <li>When you can login check on Admin-UI which error you should fix in the <code class="language-plaintext highlighter-rouge">/etc/nextcloud/config.php</code>, because an update of the configuration is needed.</li> </ul> <h2 id="nextcloud-hub-28---29">Nextcloud Hub 28 -&gt; 29</h2> <h3 id="specialties">Specialties</h3> <ul> <li>With the update to nextcloud29 occ has its own package in alpine linux</li> <li>From upgrade nextcloud 28 to 29 the php version changed and I had to update some more packages. Make sure to run occ from the target version.</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apk add nextcloud29
apk add nextcloud29-occ

<span class="c">#ensure to use the new occ version</span>
which occ
</code></pre></div></div> <h3 id="post-upgrade">Post-Upgrade</h3> <ul> <li>Enable maintenance mode</li> </ul> <h4 id="php-83">PHP 8.3</h4> <ul> <li>Between nextcloud28 and nextcloud29 there were changes in the php version, so I had to install the following php packages</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apk add php83 php83-xml libxml2 libxml2-dev php83-xmlreader php83-xmlwriter php83-simplexml php83-pecl-redis php83-pdo_mysql php83-fpm
</code></pre></div></div> <ul> <li>Configure php83-fpm <code class="language-plaintext highlighter-rouge">nano /etc/php83/php-fpm.d/www.conf</code></li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>www]
user <span class="o">=</span> nginx
group <span class="o">=</span> nginx
listen <span class="o">=</span> /run/nextcloud/fastcgi.sock
listen.owner <span class="o">=</span> nginx
listen.group <span class="o">=</span> nginx
listen.mode <span class="o">=</span> 0660
pm <span class="o">=</span> dynamic
pm.max_children <span class="o">=</span> 5
pm.start_servers <span class="o">=</span> 2
pm.min_spare_servers <span class="o">=</span> 1
pm.max_spare_servers <span class="o">=</span> 3
<span class="nb">env</span><span class="o">[</span>PATH] <span class="o">=</span> /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</code></pre></div></div> <ul> <li>Add to auto start</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rc-service php-fpm83 start
rc-update add php-fpm83 default
</code></pre></div></div> <br /><div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="javascript:void(0)" onclick="share()" class="mastodon-share-button" style="margin-top:5px;" > Mastodon </a> </div> <script> function share() { const instance = prompt("Enter your Mastodon instance URL (e.g., mastodon.social):", "mastodon.social"); if (instance) { const text = encodeURIComponent("Updating Nextcloud on Proxmox LXC with Alpine Linux http://localhost:4000/blog/2025-01-26-update-nextcloud-proxmox/"); window.open(`https://${instance}/share?text=${text}`, '_blank'); } } </script><!-- Author box --> <div class="card"> <div class="card-header"> About Ann-Jacqueline Lange </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="http://localhost:4000/assets/img/authors/maocypher.jpg" alt="Ann-Jacqueline Lange" /> </div> <div class="col-md-6"> <p class="author_bio">Hi, my name is Ann-Jacqueline Lange. I am C# cloud developer.</p> <p>Email : code@maocypher.dev</p> <p>Website : http://maocypher.dev</p> <p class="profile-links"> <a class="social-link" href="https://github.com/maocypher" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/ann-jacqueline-lange" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> </p> </div> </div> </div> </div> </div> </article> <script> var disqus_config = function () { this.page.url = "http://localhost:4000/blog/2025-01-26-update-nextcloud-proxmox/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/update-nextcloud-proxmox"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Ann-Jacqueline Lange</div> <div class="card-body"> <p class="author_bio">Hi, my name is Ann-Jacqueline Lange. I am C# cloud developer.</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/maocypher" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star maocypher on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#homelab"></div> <li class="tag-head"> <a href="/blog/categories/homelab">homelab</a> </li> <a name="homelab"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://localhost:4000/">Home</a> </li> <li> <a href="http://localhost:4000/about">About</a> </li> <li> <a href="http://localhost:4000/blog">Blog</a> </li> </div> </div> </div> </div> </div><footer> <p> Used Jekyll Theme: <a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a></p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
